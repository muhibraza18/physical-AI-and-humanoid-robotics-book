# Data Model: Integrated RAG Chatbot

This document defines the key entities and their attributes for the Integrated RAG Chatbot feature.

## Entities

### Book Content Chunk

A segmented piece of the book content, used as the fundamental unit for embedding and retrieval.

-   **`text`**: `string`
    -   Description: The actual textual content of the chunk.
-   **`embedding`**: `array` of `float`
    -   Description: The numerical vector representation of the chunk, generated by the Cohere API.
-   **`metadata`**: `object`
    -   Description: Associated contextual information for the chunk.
    -   **`file_path`**: `string`
        -   Description: The original path to the Markdown/MDX source file.
    -   **`chapter`**: `string`
        -   Description: The title or identifier of the chapter the chunk belongs to.
    -   **`section`**: `string`
        -   Description: The heading or sub-section the chunk belongs to.
    -   **`page_number`**: `integer`, `nullable`
        -   Description: The page number within the book where the chunk appears (if extractable).
    -   **`chapter_id`**: `string`, `nullable`
        -   Description: A unique identifier for the chapter.

### Embedding

A numerical vector used for semantic similarity search.

-   **`vector`**: `array` of `float`
    -   Description: The high-dimensional vector representing the semantic meaning of a `Book Content Chunk` or `User Query`.

### User Query

The input provided by the user to the chatbot.

-   **`query_text`**: `string`
    -   Description: The natural language question posed by the user.
-   **`selected_text`**: `string`, `nullable`
    -   Description: Optional text segment from the book explicitly selected by the user to provide additional context for their question.

### Chat Response

The output generated by the RAG system in response to a `User Query`.

-   **`answer`**: `string`
    -   Description: The generated textual response to the user's question.
-   **`source_references`**: `array` of `object`
    -   Description: A list of metadata from the `Book Content Chunks` that were used to formulate the `answer`. Each object in the array contains:
        -   **`file_path`**: `string`
        -   **`chapter`**: `string`
        -   **`section`**: `string`
        -   **`page_number`**: `integer`, `nullable`
        -   **`chapter_id`**: `string`, `nullable`

### Chat History/Log Entry (for Neon Postgres)

Record of user interactions and system responses for logging and auditing purposes.

-   **`session_id`**: `string`
    -   Description: A unique identifier for a continuous chat session.
-   **`query_id`**: `string`
    -   Description: A unique identifier for each individual user query within a session.
-   **`query_text`**: `string`
    -   Description: The original question submitted by the user.
-   **`timestamp`**: `datetime`
    -   Description: The UTC timestamp when the query was received.
-   **`retrieved_references`**: `array` of `object`
    -   Description: Metadata of the `Book Content Chunks` retrieved by Qdrant for the query.
-   **`generated_response_text`**: `string`
    -   Description: The full response text generated by the RAG agent.
-   **`selected_text`**: `string`, `nullable`
    -   Description: The text selected by the user, if any, that informed the query.
-   **`response_latency_ms`**: `integer`, `nullable`
    -   Description: The total time taken (in milliseconds) to generate the response.
-   **`llm_model_used`**: `string`, `nullable`
    -   Description: The specific LLM model used for generating the response.
